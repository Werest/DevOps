# Итоговый проект модуля «Облачная инфраструктура. Terraform»

## Инструменты и дополнительные материалы, которые пригодятся для выполнения задания:

- Docker
- Docker Compose
- Terraform

## Описание итогового проекта:

Задания итогового проекта охватывают полный цикл создания и настройки инфраструктуры, установку необходимых инструментов, сборку и развертывание приложения, а также хранение образов в реестре контейнеров.

## Инструкция по выполнению итогового проекта:

Используя инструменты Docker, Docker Compose и Terraform, вам необходимо сделать следующее:
 
Задание 1. Развертывание инфраструктуры в Yandex Cloud.
- Создайте Virtual Private Cloud (VPC).
- Создайте подсети.
- Создайте виртуальные машины (VM):
- Настройте группы безопасности (порты 22, 80, 443).
- Привяжите группу безопасности к VM.
- Опишите создание БД MySQL в Yandex Cloud.
- Опишите создание Container Registry.

Задание 2. Используя user-data (cloud-init), установите Docker и Docker Compose (см. Задания 5 модуля «Виртуализация и контейнеризация»).
Задание 3. Опишите Docker файл (см. Задания 5 «Виртуализация и контейнеризация») c web-приложением и сохраните контейнер в Container Registry.
Задание 4. Завяжите работу приложения в контейнере на БД в Yandex Cloud.
Задание 5*. Положите пароли от БД в LockBox и настройте интеграцию с Terraform так, чтобы пароль для БД брался из LockBox.

container-registry.images.pusher
container-registry.images.puller

# Modules

## Contrainer Registry
Создает новый собственный реестр докер образов с помощью ```yandex_container_registry```

## Group Security
Создание групп доступа (безопасности)
```app_security```
- Разрешает входящие подключения на порты:
    - 22 — SSH
    - 80 — HTTP
    - 443 — HTTPS
egress соединения разрешены

```db_security```
Разрешает входящие подключения на порт 3306 только из ```app_security```
Все egress соединения.

## Mysql
Создаём БД для приложения с помощью ресурса ```yandex_mdb_mysql_cluster```
Параметры хост, название БД , пользователь, пароль передаются через cloud-init

## VM
Создаем виртуальные машины
- с помощью cloud-init устанавливаем нужные пакет
- создаем пользователя для ВМ
- ставим Docker (Compose)
- На VM скачивается репозиторий веб приложения, собирается образ и закидывается в Реестр Контейнеров
- Дальше уже именно в реестра поднимается веб приложение
- Образ машины - *ubuntu-2204-lts*
- Назначается сервисный аккаунт

## VPC
Создает сеть и подсети. Подсети создаются в двух зонах ru-central1-a / ru-central1-b

Используется [git репозиторий](https://github.com/Werest/shvirtd-example-python) для работы на VM

По итогу приложение работает по публичному IP машины